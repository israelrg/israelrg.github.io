"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[381],{68:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>u,frontMatter:()=>t,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"Documentaci\xf3n/\ud83d\udcc1 High Availability Cluster en RH10/pcs_lvm_filesystem","title":"\ud83d\udcc4 [2025-08-26] Cluster PCS LVM | Filesystem","description":"<img src=\'httpsimage/svg%2bxml;base64,","source":"@site/docs/Documentaci\xf3n/\ud83d\udcc1 High Availability Cluster en RH10/pcs_lvm_filesystem.md","sourceDirName":"Documentaci\xf3n/\ud83d\udcc1 High Availability Cluster en RH10","slug":"/Documentaci\xf3n/\ud83d\udcc1 High Availability Cluster en RH10/pcs_lvm_filesystem","permalink":"/docs/Documentaci\xf3n/\ud83d\udcc1 High Availability Cluster en RH10/pcs_lvm_filesystem","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"\ud83d\udcc4 [2025-08-26] Cluster PCS LVM | Filesystem"},"sidebar":"tutorialSidebar","previous":{"title":"\ud83d\udcc4 [2025-08-15] Configuraci\xf3n de recursos de cluster","permalink":"/docs/Documentaci\xf3n/\ud83d\udcc1 High Availability Cluster en RH10/pcs_resources"}}');var i=s(4848),r=s(8453);const t={sidebar_position:3,title:"\ud83d\udcc4 [2025-08-26] Cluster PCS LVM | Filesystem"},o=void 0,c={},l=[{value:"Resumen",id:"resumen",level:2},{value:"1. Importar disco iSCSI",id:"1-importar-disco-iscsi",level:2},{value:"2. Crear LVM y sistema de archivos",id:"2-crear-lvm-y-sistema-de-archivos",level:2},{value:"Crear PV, VG, LV",id:"crear-pv-vg-lv",level:3},{value:"Crear y montar FS",id:"crear-y-montar-fs",level:3},{value:"3. Crear los recursos de cluster",id:"3-crear-los-recursos-de-cluster",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",hr:"hr",img:"img",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{children:(0,i.jsx)("a",{children:(0,i.jsx)("img",{src:"https://img.shields.io/badge/2025_08_26-100000?style=for-the-badge&logo=data:image/svg%2bxml;base64,\nPD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48IS0tIFVwbG9hZGVkIHRvOiBT\nVkcgUmVwbywgd3d3LnN2Z3JlcG8uY29tLCBHZW5lcmF0b3I6IFNWRyBSZXBvIE1peGVyIFRvb2xz\nIC0tPg0KPHN2ZyB3aWR0aD0iODAwcHgiIGhlaWdodD0iODAwcHgiIHZpZXdCb3g9IjAgMCAyNCAy\nNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4NCjxwYXRo\nIGQ9Ik0zIDlIMjFNMTcgMTMuMDAxNEw3IDEzTTEwLjMzMzMgMTcuMDAwNUw3IDE3TTcgM1Y1TTE3\nIDNWNU02LjIgMjFIMTcuOEMxOC45MjAxIDIxIDE5LjQ4MDIgMjEgMTkuOTA4IDIwLjc4MkMyMC4y\nODQzIDIwLjU5MDMgMjAuNTkwMyAyMC4yODQzIDIwLjc4MiAxOS45MDhDMjEgMTkuNDgwMiAyMSAx\nOC45MjAxIDIxIDE3LjhWOC4yQzIxIDcuMDc5ODkgMjEgNi41MTk4NCAyMC43ODIgNi4wOTIwMkMy\nMC41OTAzIDUuNzE1NjkgMjAuMjg0MyA1LjQwOTczIDE5LjkwOCA1LjIxNzk5QzE5LjQ4MDIgNSAx\nOC45MjAxIDUgMTcuOCA1SDYuMkM1LjA3OTkgNSA0LjUxOTg0IDUgNC4wOTIwMiA1LjIxNzk5QzMu\nNzE1NjkgNS40MDk3MyAzLjQwOTczIDUuNzE1NjkgMy4yMTc5OSA2LjA5MjAyQzMgNi41MTk4NCAz\nIDcuMDc5ODkgMyA4LjJWMTcuOEMzIDE4LjkyMDEgMyAxOS40ODAyIDMuMjE3OTkgMTkuOTA4QzMu\nNDA5NzMgMjAuMjg0MyAzLjcxNTY5IDIwLjU5MDMgNC4wOTIwMiAyMC43ODJDNC41MTk4NCAyMSA1\nLjA3OTg5IDIxIDYuMiAyMVoiIHN0cm9rZT0iIzAwMDAwMCIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJv\na2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz4NCjwvc3ZnPg==\n&logoColor=FFFFFF&labelColor=ffb454&color=ffb454"})})}),"\n",(0,i.jsx)(n.h2,{id:"resumen",children:"Resumen"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"image",src:s(959).A+"",width:"3852",height:"1938"})}),"\n",(0,i.jsxs)(n.p,{children:["Este manual documenta c\xf3mo crear un recurso de tipo LVM y sistema de archivos en un cl\xfaster RH10 utilizando PCS. Se parte de la base del entorno creado en la secci\xf3n de ",(0,i.jsx)(n.a,{href:"/docs/Documentaci%C3%B3n/%F0%9F%93%81%20High%20Availability%20Cluster%20en%20RH10/Instalaci%C3%B3n",children:"instalaci\xf3n"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"Para la creaci\xf3n de un recurso LVM, es necesario crear primero un dispositivo de bloque iSCSI accesible desde ambos nodos del cl\xfaster. Este manual no profundiza en c\xf3mo crear un dispositivo de estas caracter\xedsticas."}),"\n",(0,i.jsxs)(n.p,{children:["Este documento se basa en la ",(0,i.jsx)(n.a,{href:"https://docs.redhat.com/en/documentation/red_hat_enterprise_linux/8/html-single/configuring_and_managing_high_availability_clusters/index#assembly_configuring-active-passive-http-server-in-a-cluster-configuring-and-managing-high-availability-clusters",children:"gu\xeda oficial de Red Hat"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"1-importar-disco-iscsi",children:"1. Importar disco iSCSI"}),"\n",(0,i.jsx)(n.p,{children:"Para este laboratorio, he creado un tercer servidor que act\xfaa como servidor de almacenamiento. Este servidor ejecuta TrueNAS, el cual exporta un dispositivo de bloque de 10 GB. Este disco ser\xe1 accesible desde ambos nodos. En un entorno de producci\xf3n, estos recursos de almacenamiento deben estar redundados, pero en este caso lo omitiremos."}),"\n",(0,i.jsx)(n.p,{children:"A continuaci\xf3n, se presentan los comandos que he utilizado para a\xf1adir el nuevo dispositivo de bloque iSCSI:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Descubrir y listar IQNs disponibles\nroot@node1:~# iscsiadm -m discovery -t sendtargets -p 10.10.10.7 \n10.10.10.7:3260,1 iqn.2005-10.org.freenas.ctl:extent1\n\n# Acceso y login al export\nroot@node1:~# iscsiadm -m node -T iqn.2005-10.org.freenas.ctl:extent1 -p 10.10.10.7 -l\nLogging in to [iface: default, target: iqn.2005-10.org.freenas.ctl:extent1, portal: 10.10.10.7,3260]\nLogin to [iface: default, target: iqn.2005-10.org.freenas.ctl:extent1, portal: 10.10.10.7,3260] successful.\n\n# Login autom\xe1tico en boot\nroot@node1:~# iscsiadm -m node -T iqn.2005-10.org.freenas.ctl:extent1 -p 10.10.10.7 --op update -n node.startup -v automatic\n"})}),"\n",(0,i.jsx)(n.p,{children:"Una vez conectado al servidor, el disco deber\xeda aparecer disponible."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"root@node1:~# lsblk\nNAME               MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS\nsda                  8:0    0   50G  0 disk \n\u251c\u2500sda1               8:1    0  600M  0 part /boot/efi\n\u251c\u2500sda2               8:2    0    1G  0 part /boot\n\u2514\u2500sda3               8:3    0 48.4G  0 part \n  \u251c\u2500almalinux-root 253:0    0 43.4G  0 lvm  /\n  \u2514\u2500almalinux-swap 253:1    0    5G  0 lvm  [SWAP]\n#highlight-start\nsdb                  8:16   0   10G  0 disk \n#highlight-end\nsr0                 11:0    1  6.8G  0 rom  \n\nroot@node2:~# lsblk\nNAME                   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS\nsda                      8:0    0   50G  0 disk \n\u251c\u2500sda1                   8:1    0  600M  0 part /boot/efi\n\u251c\u2500sda2                   8:2    0    1G  0 part /boot\n\u2514\u2500sda3                   8:3    0 48.4G  0 part \n  \u251c\u2500almalinux_192-root 253:0    0 43.4G  0 lvm  /\n  \u2514\u2500almalinux_192-swap 253:1    0    5G  0 lvm  [SWAP]\n#highlight-start\nsdb                      8:16   0   10G  0 disk \n#highlight-end\nsr0                     11:0    1  6.8G  0 rom  \n"})}),"\n",(0,i.jsx)(n.p,{children:"Aqu\xed tienes el texto corregido y mejorado:"}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"2-crear-lvm-y-sistema-de-archivos",children:"2. Crear LVM y sistema de archivos"}),"\n",(0,i.jsxs)(n.p,{children:["En primer lugar, se debe a\xf1adir la siguiente l\xednea de configuraci\xf3n en ",(0,i.jsx)(n.code,{children:"/etc/lvm/lvm.conf"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["El ",(0,i.jsx)(n.strong,{children:"SystemID"})," en LVM es un identificador que restringe el acceso a un VG a un solo host, evitando que m\xfaltiples hosts utilicen el VG simult\xe1neamente. Esta caracter\xedstica es \xfatil cuando los VGs se colocan en dispositivos de almacenamiento compartido, asegurando que solo el host con el ID del sistema coincidente pueda acceder al VG."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-jsx",metastring:'title="/etc/lvm/lvm.conf"',children:'# Configuration option global/system_id_source.\nsystem_id_source = "uname"\n'})}),"\n",(0,i.jsx)(n.p,{children:"Comprobaci\xf3n de la configuraci\xf3n."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'root@node1:~# lvm dumpconfig\n-------\nactivation {\n}\nglobal {\n\tsystem_id_source="uname"\n}\nshell {\n}\n------\nroot@node1:~# lvm systemid\n  system ID: node1\n'})}),"\n",(0,i.jsx)(n.h3,{id:"crear-pv-vg-lv",children:"Crear PV, VG, LV"}),"\n",(0,i.jsx)(n.p,{children:"Los siguientes comandos se ejecutar\xe1n \xfanicamente en un nodo, dado que el disco es el mismo para ambos nodos."}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"PV"}),(0,i.jsx)(n.th,{children:"VG"}),(0,i.jsx)(n.th,{children:"LV"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"/dev/sdb"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"vg01"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"my_lv"})})]})})]}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.p,{children:['"La opci\xf3n ',(0,i.jsx)(n.code,{children:"--setautoactivation n"})," durante la creaci\xf3n del ",(0,i.jsx)(n.strong,{children:"VG"})," se utiliza para evitar que el sistema active los recursos al arrancar por defecto. ",(0,i.jsx)(n.a,{href:"https://www.man7.org/linux/man-pages/man8/vgcreate.8.html",children:"Enlace a la documentaci\xf3n"}),'."']})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# Crear PV\nroot@node1:~# pvcreate /dev/sdb \n  Physical volume "/dev/sdb" successfully created.\nroot@node1:~# pvs\n  PV         VG        Fmt  Attr PSize  PFree \n  /dev/sda3  almalinux lvm2 a--  48.41g     0 \n  /dev/sdb             lvm2 ---  10.00g 10.00g\n\n# Crear VG\nroot@node1:~# vgcreate --setautoactivation n vg01 /dev/sdb\n  Volume group "vg01" successfully created with system ID node1\nroot@node1:~# vgs -o+systemid\n  VG        #PV #LV #SN Attr   VSize  VFree System ID\n  almalinux   1   2   0 wz--n- 48.41g    0           \n  vg01        1   0   0 wz--n- 10.00g    0  node1    \n\n# Crear LV\nroot@node1:~# lvcreate -n my_lv -l 100%FREE vg01\n  Logical volume "my_lv" created.\n'})}),"\n",(0,i.jsx)(n.h3,{id:"crear-y-montar-fs",children:"Crear y montar FS"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"root@node1:~# mkfs.xfs /dev/vg01/my_lv \nspecified blocksize 4096 is less than device physical sector size 16384\nswitching to logical sector size 4096\nmeta-data=/dev/vg01/my_lv        isize=512    agcount=4, agsize=639488 blks\n"})}),"\n",(0,i.jsx)(n.p,{children:"Una vez creado el sistema de archivos, monta el sistema de archivos y a\xf1adir la web que debe estar en alta disponibilidad."}),"\n",(0,i.jsx)(n.h2,{id:"3-crear-los-recursos-de-cluster",children:"3. Crear los recursos de cluster"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# Crear recurso LVM-activate\npcs resource create my_lvm ocf:heartbeat:LVM-activate vgname=vg01 vg_access_mode=system_id --group apachegroup\n# Crear recurso Filesystem\npcs resource create my_fs Filesystem device="/dev/vg01/my_lv" directory="/var/www" fstype="xfs" --group apachegroup\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"root@node1:~# lsblk\n--------\nsdb                  8:16   0  9.8G  0 disk \n\u2514\u2500vg01-my_lv       253:2    0  9.8G  0 lvm  /var/www\n--------\n\nroot@node1:~# pcs resource status\n  * Resource Group: apachegroup:\n    * VirtualIP\t(ocf:heartbeat:IPaddr2):\t Started node1\n    * my_lvm\t(ocf:heartbeat:LVM-activate):\t Started node1\n    * my_fs\t(ocf:heartbeat:Filesystem):\t Started node1\n  * Clone Set: Website-clone [Website]:\n    * Started: [ node1 node2 ]\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Si accedemos a la web desde la ",(0,i.jsx)(n.strong,{children:"VIP"}),", deber\xedamos ver la web activa. Para comprobar que el balanceo funciona correctamente, ejecutar ",(0,i.jsx)(n.code,{children:"pcs node unstandby node1"}),"."]})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},959:(e,n,s)=>{s.d(n,{A:()=>a});const a=s.p+"assets/images/a1-e41ac0e03c24d99cf109ec7d082b89c2.png"},8453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>o});var a=s(6540);const i={},r=a.createContext(i);function t(e){const n=a.useContext(r);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),a.createElement(r.Provider,{value:n},e.children)}}}]);