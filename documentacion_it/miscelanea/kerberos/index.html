<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-documentacion_it/miscelanea/kerberos" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">üìÑ Configuraci√≥n de SSH + kerberos | My Site</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://www.israelrodriguez.xyz/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://www.israelrodriguez.xyz/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://www.israelrodriguez.xyz/documentacion_it/miscelanea/kerberos"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="üìÑ Configuraci√≥n de SSH + kerberos | My Site"><meta data-rh="true" name="description" content="2023-02-01"><meta data-rh="true" property="og:description" content="2023-02-01"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://www.israelrodriguez.xyz/documentacion_it/miscelanea/kerberos"><link data-rh="true" rel="alternate" href="https://www.israelrodriguez.xyz/documentacion_it/miscelanea/kerberos" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.israelrodriguez.xyz/documentacion_it/miscelanea/kerberos" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"üìÅ Documentaci√≥n IT","item":"https://www.israelrodriguez.xyz/documentacion_it/"},{"@type":"ListItem","position":2,"name":"üìÅ Miscelanea","item":"https://www.israelrodriguez.xyz/documentacion_it/miscelanea/"},{"@type":"ListItem","position":3,"name":"üìÑ Configuraci√≥n de SSH + kerberos","item":"https://www.israelrodriguez.xyz/documentacion_it/miscelanea/kerberos"}]}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="My Site RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="My Site Atom Feed"><link rel="stylesheet" href="/assets/css/styles.b7fd2066.css">
<script src="/assets/js/runtime~main.acc70093.js" defer="defer"></script>
<script src="/assets/js/main.8664d261.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>document.documentElement.setAttribute("data-theme","light"),document.documentElement.setAttribute("data-theme-choice","light"),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top navbar--dark"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Israel Rodr√≠guez</b></a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbarSearchContainer_Bca1"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-current"></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/"><span title="üü† Inicio" class="linkLabel_WmDU">üü† Inicio</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" href="/documentacion_it/"><span title="üìÅ Documentaci√≥n IT" class="categoryLinkLabel_W154">üìÅ Documentaci√≥n IT</span></a><button aria-label="Collapse sidebar category &#x27;üìÅ Documentaci√≥n IT&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/documentacion_it/high_availability_clusters_docs/"><span title="üìÅ Clusters de alta disponibilidad RedHat" class="categoryLinkLabel_W154">üìÅ Clusters de alta disponibilidad RedHat</span></a><button aria-label="Collapse sidebar category &#x27;üìÅ Clusters de alta disponibilidad RedHat&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/documentacion_it/high_availability_clusters_docs/Instalaci√≥n"><span title="üìÑ Instalaci√≥n pacemaker | corosync" class="linkLabel_WmDU">üìÑ Instalaci√≥n pacemaker | corosync</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/documentacion_it/high_availability_clusters_docs/pcs_resources"><span title="üìÑ Configuraci√≥n de recursos de cluster" class="linkLabel_WmDU">üìÑ Configuraci√≥n de recursos de cluster</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/documentacion_it/high_availability_clusters_docs/pcs_lvm_filesystem"><span title="üìÑ Cluster PCS LVM | Filesystem" class="linkLabel_WmDU">üìÑ Cluster PCS LVM | Filesystem</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" tabindex="0" href="/documentacion_it/miscelanea/"><span title="üìÅ Miscelanea" class="categoryLinkLabel_W154">üìÅ Miscelanea</span></a><button aria-label="Collapse sidebar category &#x27;üìÅ Miscelanea&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/documentacion_it/miscelanea/kerberos"><span title="üìÑ Configuraci√≥n de SSH + kerberos" class="linkLabel_WmDU">üìÑ Configuraci√≥n de SSH + kerberos</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/documentacion_it/miscelanea/lpic_102_exam"><span title="üìÑ LPI 102 - Apuntes examen" class="linkLabel_WmDU">üìÑ LPI 102 - Apuntes examen</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/documentacion_it/miscelanea/sortear_conexiones_ssh"><span title="üìÑ Sortear conexiones detr√°s de firewall via SSH" class="linkLabel_WmDU">üìÑ Sortear conexiones detr√°s de firewall via SSH</span></a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/documentacion_ecom/"><span title="üìÅ Documentaci√≥n Econom√≠a" class="linkLabel_WmDU">üìÅ Documentaci√≥n Econom√≠a</span></a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/documentacion_it/"><span>üìÅ Documentaci√≥n IT</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/documentacion_it/miscelanea/"><span>üìÅ Miscelanea</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">üìÑ Configuraci√≥n de SSH + kerberos</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Configuraci√≥n de SSH + kerberos</h1></header>
<span class="badge badge--primary">2023-02-01</span>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="definici√≥n-y-objetivos">Definici√≥n y objetivos<a href="#definici√≥n-y-objetivos" class="hash-link" aria-label="Direct link to Definici√≥n y objetivos" title="Direct link to Definici√≥n y objetivos" translate="no">‚Äã</a></h2>
<p>Esta documentaci√≥n se centra en el despliegue de un servidor Kerberos en un entorno de red y su integraci√≥n con SSH.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="networking">Networking<a href="#networking" class="hash-link" aria-label="Direct link to Networking" title="Direct link to Networking" translate="no">‚Äã</a></h3>
<table><thead><tr><th>megatron.local</th><th>INTERFACE1</th><th>IP management</th><th>INTERFACE2</th><th>IP2 service</th></tr></thead><tbody><tr><td>kserver</td><td>ens18</td><td>192.168.4.201/24</td><td>ens19</td><td>10.0.8.10/24</td></tr><tr><td>khost1</td><td>ens18<br></td><td>192.168.4.202/24</td><td>ens19<br></td><td>10.0.8.50/24</td></tr><tr><td>khost2</td><td>ens18<br></td><td>192.168.4.203/24<br></td><td>ens19<br></td><td>10.0.8.51/24</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="esquema-de-la-arquitectura">Esquema de la arquitectura<a href="#esquema-de-la-arquitectura" class="hash-link" aria-label="Direct link to Esquema de la arquitectura" title="Direct link to Esquema de la arquitectura" translate="no">‚Äã</a></h3>
<p>‚Äã<img decoding="async" loading="lazy" alt="image" src="/assets/images/image-20240203141253-chw0tv0-c6d269c6d2fa3a499d0192368401dbe2.png" width="1192" height="692" class="img_ev3q">‚Äã</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="configuraci√≥n">Configuraci√≥n<a href="#configuraci√≥n" class="hash-link" aria-label="Direct link to Configuraci√≥n" title="Direct link to Configuraci√≥n" translate="no">‚Äã</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="configuracion-krserver">Configuracion krserver<a href="#configuracion-krserver" class="hash-link" aria-label="Direct link to Configuracion krserver" title="Direct link to Configuracion krserver" translate="no">‚Äã</a></h3>
<p>Insertar registros DNS de forma manual en /etc/hosts</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">127.0.0.1       localhost</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">127.0.1.1       kserver.megatron.local  kserver</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># KERBEROS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10.0.8.10       kserver.megatron.local</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10.0.8.50       khost1.megatron.local</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10.0.8.51       khost2.megatron.local</span><br></span></code></pre></div></div>
<p>Instalar paquetes</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">apt install krb5-kdc krb5-admin-server</span><br></span></code></pre></div></div>
<p>Configurar datos de entrada para el servidor del reino y el dominio del servidor</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Reino: MEGATRON.LOCAL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ser. Kerberos: krserver.megatron.local</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Serv. Admin Kerberos: krserver.megatron.local</span><br></span></code></pre></div></div>
<p>Desactivar Ks4 /etc/default/krb5-kdc. A√±adir</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">KRB4_MODE=disable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RUN_KRB524D=false</span><br></span></code></pre></div></div>
<p>A√±dir en /etc/krb5.conf. El resto de realms configurados por defecto se pueden borrar</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[domain_realm]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .megatron.local = MEGATRON.LOCAL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        megatron.local = MEGATRON.LOCAL</span><br></span></code></pre></div></div>
<p>Definir nuevo realm y reiniciar servicios. Importante agregar contrase√±a</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">krb5_newrealm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl start krb5-admin-server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl start krb5-kdc</span><br></span></code></pre></div></div>
<p>Acceder a la consola de kerberos. Nos pide contrase√±a root realm</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kadmin.local</span><br></span></code></pre></div></div>
<p>Crear usuario y agregarlo como administrador. Nos pide contrase√±a para el usuario</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kadmin.local: add_principal israel@MEGATRON.LOCAL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kadmin.local: add_principal israel/admin@MEGATRON.LOCAL</span><br></span></code></pre></div></div>
<p>Habilitamos usuarios administradores descomentado la linea en /etc/krb5kdc/kadm5.acl</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">*/admin *</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="configurar-los-clientes-de-kerberos-khost1-khost2">Configurar los clientes de KERBEROS (KHOST1 KHOST2)<a href="#configurar-los-clientes-de-kerberos-khost1-khost2" class="hash-link" aria-label="Direct link to Configurar los clientes de KERBEROS (KHOST1 KHOST2)" title="Direct link to Configurar los clientes de KERBEROS (KHOST1 KHOST2)" translate="no">‚Äã</a></h3>
<p>Al no configurar DNS metemos registros a mano.  /etc/hosts</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">127.0.0.1       localhost</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">127.0.1.1       khost2.megatron.local   khost2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># KERBEROS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10.0.8.10       kserver.megatron.local</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10.0.8.50       khost1.megatron.local</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10.0.8.51       khost2.megatron.local</span><br></span></code></pre></div></div>
<p>Instalar paquetes y configurar</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">apt-get install krb5-user krb5-config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Reino: MEGATRON.LOCAL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Ser. Kerberos: krserver.megatron.local</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Serv. Admin Kerberos: krserver.megatron.local</span><br></span></code></pre></div></div>
<p>A√±dir en /etc/krb5.conf. El resto de realms configurados por defecto se pueden borrar</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[domain_realm]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .megatron.local = MEGATRON.LOCAL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        megatron.local = MEGATRON.LOCAL</span><br></span></code></pre></div></div>
<p>Compobamos que obtenemo ticket de krserver. Nos pide contrase√±a de usuarios</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">x@khost2:~$ kinit israel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Password for israel@MEGATRON.LOCAL:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x@khost2:~$ klist</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ticket cache: FILE:/tmp/krb5cc_1000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Default principal: israel@MEGATRON.LOCAL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Valid starting       Expires              Service principal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10/28/2022 15:02:08  10/29/2022 01:02:08  krbtgt/MEGATRON.LOCAL@MEGATRON.LOCAL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        renew until 10/29/2022 15:01:39</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x@khost2:~$</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="configurar-servidor-ssh-khost2">Configurar servidor ssh (KHOST2)<a href="#configurar-servidor-ssh-khost2" class="hash-link" aria-label="Direct link to Configurar servidor ssh (KHOST2)" title="Direct link to Configurar servidor ssh (KHOST2)" translate="no">‚Äã</a></h3>
<p>En el servidor krserver generamos y exportamos las claves del servidor ssh khost2</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">kadmin.local</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kadmin.local: add_principal -randkey host/khost2.megatron.local@MEGATRON.LOCAL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kadmin.local: ktadd host/israel.megatron.local</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kadmin.local: ktadd -k /tmp/khost2.keytab host/khost2.megatron.local@MEGATRON.LOCAL</span><br></span></code></pre></div></div>
<p>Le eviamos la clave generada a khost2</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">scp /tmp/khost2.keytab x@khost2.megatron.local:/home/x</span><br></span></code></pre></div></div>
<p>En el servidor ssh khost2 movemos las claves a /etc y damos permisos</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">chmod 400 /etc/khost2.keytab</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">chown sshd:ssh /etc/khost2.keytab</span><br></span></code></pre></div></div>
<p>Activar en /etc/ssh/sshd_config</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># GSSAPI options</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GSSAPIAuthentication yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GSSAPICleanupCredentials yes</span><br></span></code></pre></div></div>
<p>Reiniciar daemon ssd</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl restart sshd</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="configurar-cliente-ssh-khost1">Configurar cliente ssh (KHOST1)<a href="#configurar-cliente-ssh-khost1" class="hash-link" aria-label="Direct link to Configurar cliente ssh (KHOST1)" title="Direct link to Configurar cliente ssh (KHOST1)" translate="no">‚Äã</a></h3>
<p>Editar /etc/ssh/ssh_config</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">GSSAPIAuthentication yes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">GSSAPIDelegateCredentials yes</span><br></span></code></pre></div></div>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl restart ssh</span><br></span></code></pre></div></div>
<p>Obtener ticket con el usuario</p>
<blockquote>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">x@khost2:~$ kinit israel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Password for israel@MEGATRON.LOCAL:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x@khost2:~$ klist</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ticket cache: FILE:/tmp/krb5cc_1000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Default principal: israel@MEGATRON.LOCAL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Valid starting       Expires              Service principal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10/28/2022 15:02:08  10/29/2022 01:02:08  krbtgt/MEGATRON.LOCAL@MEGATRON.LOCAL</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        renew until 10/29/2022 15:01:39</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x@khost2:~$</span><br></span></code></pre></div></div>
</blockquote>
<p>Ya nos podemos loggear al el servidor ssh (khost2) desde khost1</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">x@khost1:~$ ssh -v israel@khost2.megatron.local</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OpenSSH_8.4p1 Debian-5+deb11u1, OpenSSL 1.1.1n  15 Mar 2022</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: Reading configuration data /etc/ssh/ssh_config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: /etc/ssh/ssh_config line 19: include /etc/ssh/ssh_config.d/*.conf matched no files</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: /etc/ssh/ssh_config line 21: Applying options for *</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: Connecting to khost2.megatron.local [10.0.8.51] port 22.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: Connection established.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: identity file /home/x/.ssh/id_rsa type -1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: identity file /home/x/.ssh/id_rsa-cert type -1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: identity file /home/x/.ssh/id_dsa type -1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: identity file /home/x/.ssh/id_dsa-cert type -1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: identity file /home/x/.ssh/id_ecdsa type -1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: identity file /home/x/.ssh/id_ecdsa-cert type -1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: identity file /home/x/.ssh/id_ecdsa_sk type -1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: identity file /home/x/.ssh/id_ecdsa_sk-cert type -1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: identity file /home/x/.ssh/id_ed25519 type -1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: identity file /home/x/.ssh/id_ed25519-cert type -1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: identity file /home/x/.ssh/id_ed25519_sk type -1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: identity file /home/x/.ssh/id_ed25519_sk-cert type -1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: identity file /home/x/.ssh/id_xmss type -1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: identity file /home/x/.ssh/id_xmss-cert type -1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: Local version string SSH-2.0-OpenSSH_8.4p1 Debian-5+deb11u1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: Remote protocol version 2.0, remote software version OpenSSH_8.4p1 Debian-5+deb11u1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: match: OpenSSH_8.4p1 Debian-5+deb11u1 pat OpenSSH* compat 0x04000000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: Authenticating to khost2.megatron.local:22 as &#x27;israel&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: SSH2_MSG_KEXINIT sent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: SSH2_MSG_KEXINIT received</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: kex: algorithm: curve25519-sha256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: kex: host key algorithm: ecdsa-sha2-nistp256</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: kex: server-&gt;client cipher: chacha20-poly1305@openssh.com MAC: &lt;implicit&gt; compression: none</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: kex: client-&gt;server cipher: chacha20-poly1305@openssh.com MAC: &lt;implicit&gt; compression: none</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: expecting SSH2_MSG_KEX_ECDH_REPLY</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: Server host key: ecdsa-sha2-nistp256 SHA256:V51lOSp6fLZlsISKdQFImQh7J31r+Pyt1aya+Kdrs3Y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: Host &#x27;khost2.megatron.local&#x27; is known and matches the ECDSA host key.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: Found key in /home/x/.ssh/known_hosts:1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: rekey out after 134217728 blocks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: SSH2_MSG_NEWKEYS sent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: expecting SSH2_MSG_NEWKEYS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: SSH2_MSG_NEWKEYS received</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: rekey in after 134217728 blocks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: Will attempt key: /home/x/.ssh/id_rsa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: Will attempt key: /home/x/.ssh/id_dsa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: Will attempt key: /home/x/.ssh/id_ecdsa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: Will attempt key: /home/x/.ssh/id_ecdsa_sk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: Will attempt key: /home/x/.ssh/id_ed25519</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: Will attempt key: /home/x/.ssh/id_ed25519_sk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: Will attempt key: /home/x/.ssh/id_xmss</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: SSH2_MSG_EXT_INFO received</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: kex_input_ext_info: server-sig-algs=&lt;ssh-ed25519,sk-ssh-ed25519@openssh.com,ssh-rsa,rsa-sha2-256,rsa-sha2-512,ssh-dss,ecdsa-sha2-nistp256,ecdsa-sha2-nistp384,ecdsa-sha2-nistp521,sk-ecdsa-sha2-nistp256@openssh.com,webauthn-sk-ecdsa-sha2-nistp256@openssh.com&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: SSH2_MSG_SERVICE_ACCEPT received</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: Authentications that can continue: publickey,gssapi-keyex,gssapi-with-mic,password</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: Next authentication method: gssapi-with-mic</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: Delegating credentials</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: Delegating credentials</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: Authentication succeeded (gssapi-with-mic).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Authenticated to khost2.megatron.local ([10.0.8.51]:22).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: channel 0: new [client-session]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: Requesting no-more-sessions@openssh.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: Entering interactive session.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: pledge: network</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: client_input_global_request: rtype hostkeys-00@openssh.com want_reply 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: Sending environment.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">debug1: Sending env LANG = en_US.UTF-8</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Linux khost2 5.10.0-18-amd64 #1 SMP Debian 5.10.140-1 (2022-09-02) x86_64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">The programs included with the Debian GNU/Linux system are free software;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">the exact distribution terms for each program are described in the</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">individual files in /usr/share/doc/*/copyright.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">permitted by applicable law.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Web console: https://khost2.megatron.local:9090/ or https://192.168.4.203:9090/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Last login: Fri Oct 28 14:09:35 2022 from 10.0.8.50</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">israel@khost2:~$</span><br></span></code></pre></div></div></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/documentacion_it/miscelanea/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">üìÅ Miscelanea</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/documentacion_it/miscelanea/lpic_102_exam"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">üìÑ LPI 102 - Apuntes examen</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#definici√≥n-y-objetivos" class="table-of-contents__link toc-highlight">Definici√≥n y objetivos</a><ul><li><a href="#networking" class="table-of-contents__link toc-highlight">Networking</a></li><li><a href="#esquema-de-la-arquitectura" class="table-of-contents__link toc-highlight">Esquema de la arquitectura</a></li></ul></li><li><a href="#configuraci√≥n" class="table-of-contents__link toc-highlight">Configuraci√≥n</a><ul><li><a href="#configuracion-krserver" class="table-of-contents__link toc-highlight">Configuracion krserver</a></li><li><a href="#configurar-los-clientes-de-kerberos-khost1-khost2" class="table-of-contents__link toc-highlight">Configurar los clientes de KERBEROS (KHOST1 KHOST2)</a></li><li><a href="#configurar-servidor-ssh-khost2" class="table-of-contents__link toc-highlight">Configurar servidor ssh (KHOST2)</a></li><li><a href="#configurar-cliente-ssh-khost1" class="table-of-contents__link toc-highlight">Configurar cliente ssh (KHOST1)</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Compilaci√≥n de 2025</div></div></div></footer></div>
</body>
</html>